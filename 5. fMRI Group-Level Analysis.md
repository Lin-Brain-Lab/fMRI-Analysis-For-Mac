# fMRI Group-Level Analysis (Event-Related Analysis)
## Examine Individual's Responses
>[!NOTE]
> Begin analysis by starting with steps from the [Event-Related fMRI Analysis page](https://github.com/Lin-Brain-Lab/fMRI-Analysis-For-Mac/blob/main/fMRI%20Event-Related%20Analysis.md)

1. Download [show_individual_surf](https://github.com/fahsuanlin/labmanual/blob/master/scripts/show_individual_surf_031324.m) and add to your fhlin_toolbox/group_level_analysis folder and open in MatLab
2. Make a folder /Users/jessica/data_analysis/seeg/group_level_analysis/event_related/individual and go to this directory in MatLab
3. List starting from line 4 the subjects you want to include
4. Change line 35 to your root directory `root_dir='/Users/jessica/data_analysis/seeg';`
5. Change line 49 to the location of the stc files for your subjects `'%s/%s/fmri_data/unpack/ %s-%s.stc'`
6. If done successfully, you should have 3 images for each subject ("A" for audio, "V" for visual, and "AV" for audio-visual) in the folder directory you choose
<details>
  <summary>Example of S025 V, AV, and A image</summary>
S025 V
  
![fmri_surf_031324_s025_V](https://github.com/Lin-Brain-Lab/fMRI-Analysis-For-Mac/assets/157174338/a4aa6c21-9a3f-41a5-883f-68c6ff3b365d)

s025 AV
![fmri_surf_031324_s025_AV](https://github.com/Lin-Brain-Lab/fMRI-Analysis-For-Mac/assets/157174338/08dac687-254f-4757-9890-59854232ffe9)

s025 A
![fmri_surf_031324_s025_A](https://github.com/Lin-Brain-Lab/fMRI-Analysis-For-Mac/assets/157174338/dae71213-30b3-4e70-a5ab-a26e106a6112)
</details>

## Calculate Group-Level Activation
1. Download [average_surf](https://github.com/fahsuanlin/labmanual/blob/master/scripts/average_surf_031324.m) and add to your fhlin_toolbox/group_level_analysis folder and open in MatLab
2. Make a folder /Users/jessica/data_analysis/seeg/group_level_analysis/event_related/average and go to this directory in MatLab
3. List starting from line 4 the subjects you want to include
4. Change line 35 to your root directory `root_dir='/Users/jessica/data_analysis/seeg';`
5. Change line 49 to the location of the stc files for your subjects `'%s/%s/fmri_data/unpack/%s-%s.stc'`
6. If done successfully, you should have 3 images (average of "A", "V", and "AV") in the average folder
<details>
  <summary>Example of Average V, AV, and A for s025, s026, s031, s032, and s034</summary>
  
V Average
![fmri_surf_V_average](https://github.com/Lin-Brain-Lab/fMRI-Analysis-For-Mac/assets/157174338/c7c6cd4f-85c2-4141-a5f5-556b14f65c90)
AV Average
![fmri_surf_AV_average](https://github.com/Lin-Brain-Lab/fMRI-Analysis-For-Mac/assets/157174338/9066c288-04bc-4c76-96b5-a82532878a6e)
A Average
![fmri_surf_A_average](https://github.com/Lin-Brain-Lab/fMRI-Analysis-For-Mac/assets/157174338/a41f5965-a482-4709-b26a-050141b3e8ad)
</details>

## Statistical Inferences Using FDR
1. Download [average_surf_fdr_031324](https://github.com/fahsuanlin/labmanual/blob/master/scripts/average_surf_fdr_031324.m) and add to your fhlin_toolbox/group_level_analysis folder and open in MatLab
2. In MatLab create a script called fdr.m with the follow code and add this file to yout fhlin_toolbox
```
function [pID,pN] = fdr(p,q)
% FORMAT [pID,pN] = FDR(p,q)
% 
% p   - vector of p-values
% q   - False Discovery Rate level
%
% pID - p-value threshold based on independence or positive dependence
% pN  - Nonparametric p-value threshold
%______________________________________________________________________________
% $Id: FDR.m,v 2.1 2010/08/05 14:34:19 nichols Exp $


p = p(isfinite(p));  % Toss NaN's
p = sort(p(:));
V = length(p);
I = (1:V)';

cVID = 1;
cVN = sum(1./(1:V));

pID = p(max(find(p<=I/V*q/cVID)));
if isempty(pID), pID=0; end
pN = p(max(find(p<=I/V*q/cVN)));
if isempty(pN), pN=0; end
```
3. Make a folder /Users/jessica/data_analysis/seeg/group_level_analysis/event_related/statistical_inferences and go to this directory in MatLab
4. List starting from line 4 the subjects you want to include
5. Change line 35 to your root directory `root_dir='/Users/jessica/data_analysis/seeg';`
6. Change line 50 to the location of the stc files for your subjects `'%s/%s/fmri_data/unpack/%s-%s.stc'`
7. If done successfully there should be three images in your statistical_inferences folder average_surf_fdr_031324_AV_average.png (for A, V, AV)

# fMRI Group-Level Analysis (Resting-State Analysis)
## Examine Individual's Responses
>[!NOTE]
> Begin analysis by starting with steps from the [Resting-State fMRI Analysis page](https://github.com/Lin-Brain-Lab/fMRI-Analysis-For-Mac/blob/main/6.%20Resting-State%20fMRI%20Analysis.md)

1. Download [show_individual_surf](https://github.com/fahsuanlin/labmanual/blob/master/scripts/show_individual_surf_031324.m) and add to your fhlin_toolbox/group_level_analysis folder and open in MatLab edit the file name to rest_show_individual_surf (as to not confuse with the event-related files)
2. Make a folder /Users/jessica/data_analysis/seeg/group_level_analysis/resting_state/individual and go to this directory in MatLab
3. List starting from line 4 the subjects you want to include
4. Change line 16-20 to your 2_fsaverage_hippo_fconn_032124 files (which should be located in your subjects resting analysis folder)
```
cond_stem={
    '2_fsaverage_hippo_fconn_032124'
};
```
6. Change line 22-26 to the output 
```
cond_output_stem={
    'resting';
};
```
7. Change line 29-33 to 
```
cond_stem_str={
    'resting';
    };
```
9. Change line 35 to your root directory `root_dir='/Users/jessica/data_analysis/seeg';`
10. Change line 49 to the location of the stc files for your subjects and allow for indexing of your different subject IDs and the left/right hemisphere `[dummy,v,a,b,timeVec]=inverse_read_stc(sprintf('%s/%s/resting_analysis/%s_%s-%s.stc',root_dir,subject{subj_idx},subject{subj_idx},cond_stem{cond_idx},hemi_str));`
12. Change line 59 to `'%s/group_level_analysis/resting_analysis/individual/fmri_surf_120423_%s_average.png'` the location of your individual group analysis folder
13. If done successfully, you should have in the individual folder
<details>
  <summary>Example of Individual Resting-State for s025</summary>

  
</details>


## Calculate Group-Level Activation
1. Download [average_surf change lines](https://github.com/fahsuanlin/labmanual/blob/master/scripts/average_surf_031324.m) and add to your fhlin_toolbox/group_level_analysis folder and open in MatLab edit the file name to rest_average_surf (as to not confuse with the event-related files)
2. Make a folder /Users/jessica/data_analysis/seeg/group_level_analysis/event_related/average and go to this directory in MatLab
3. List starting from line 4 the subjects you want to include
4. Change line 16-20 to your 2_fsaverage_hippo_fconn_032124 files (which should be located in your subjects resting analysis folder)
```

cond_stem={
    '2_fsaverage_hippo_fconn_032124'

};
```
6. Change line 22-26 to the output 
```
cond_output_stem={
    'resting';
};
```
7. Change line 29-33 to 
```
cond_stem_str={
    'resting';
    };
```
9. Change line 35 to your root directory `root_dir='/Users/jessica/data_analysis/seeg';`
10. Change line 49 to the location of the stc files for your subjects and allow for indexing of your different subject IDs and the left/right hemisphere `[dummy,v,a,b,timeVec]=inverse_read_stc(sprintf('%s/%s/resting_analysis/%s_%s-%s.stc',root_dir,subject{subj_idx},subject{subj_idx},cond_stem{cond_idx},hemi_str));`
12. Change line 59 to `'%s/group_level_analysis/resting_analysis/average/fmri_surf_120423_%s_average.png'` the location of your average group analysis folder
13. If done successfully, you should have an image in your average folder
<details>
  <summary>Example of Average Resting-State for s025, s026, s031, s032, and s034</summary>

  <img width="1397" alt="Screen Shot 2024-04-05 at 1 03 43 PM" src="https://github.com/Lin-Brain-Lab/fMRI-Analysis-For-Mac/assets/157174338/f1a8b809-71f8-444e-8db8-4d829ac348e2">
</details>


